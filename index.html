<!DOCTYPE html>
<html>
<head>
<title>tjh.town</title>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<link rel="stylesheet" href="style.css">

<script type="module" src="https://cdn.jsdelivr.net/gh/zerodevx/zero-md@2/dist/zero-md.min.js"></script>
<style>
	body {
		background:url('background.gif');
		background-size: cover;
	    height:100vh;
	    width:100%;
	}
	.main-col {
		background-color: rgba(255, 255, 255, 0.6);
	}	
	.card-horizontal {
		display: flex;
		flex: 1 1 auto;
		background-color: #9c9c9c;
	}
	.cover {
		margin-right: 0;
	}
	* {
	  padding: 0;
	  margin: 0 auto;
	  box-sizing: border-box;
	  color:#ffffff;
	}

	section {
	  background-color: black;
	  position: relative;
	}
	svg {
	  position: absolute;
	  width: 200px;
	  
	}
	@media (max-width: 768px) {
	  svg {
	    width: 150px;
	  }
	}
</style>


<div class="container text-center">
	
<hr>

<div class="d-flex row">
	<div class="col-md-4">

	</div>
	<div class="col-md-4 justify-content-center">
		<h1>tjh.town</h1>
	</div>
	<div class="col-md-4 justify-content-end">
		<div class="card mx-auto">
			<h5 class="card-title">What am I listening to?</h5>
			<div class="card-horizontal">
				<div class="card-body">
					
					<p class="card-text music"></p>
					<p class="card-text" id="when"></p>

				</div>
				<img src="" class="img-responsive cover float-right pull-right" alt="album cover">
			</div>
			<div class="card-footer">
				<small class="text-muted date"></small>
			</div>
		</div>
	</div>
	
</div>

<hr>

</div>
</head>
<body>
<div class="container text-center">
	
	<div class="row justify-content-center">
		<div class="col-3">

		</div>
		<div class="col-6 main-col mx-auto">
			<h1>Projects!</h1>
			<hr>
			<div>
				<a href="MusicGraph/MusicGraph.html"><h1>Music Graph</h1></a>

				<a href="WebScraping/index.html"><h1>Web Scraping</h1></a>

				<a href="dvd.html"><h1>Cool DVD</h1></a>
			</div>
		</div>
		<div class="col-3">

		</div>
	</div>
	<div class="row justify-content-center">
		<zero-md src="http://73.126.15.185:8080/MusicGraph/README.md"></zero-md>
	</div>
</body>
<script>

	function fmArtists(username) {
	  	return $.ajax({
	        dataType: 'json',
	        async: false,
	        url: 'http://ws.audioscrobbler.com/2.0/?method=user.getrecenttracks&user=' + username + '&api_key=943bdddf5707846447a81b95edae1537&limit=1&format=json'
	      });
	}
	function fmTrack(tmbid, ambid) {
		return $.ajax({
			dataType: 'json',
			async: false,
			//url : 'http://ws.audioscrobbler.com/2.0/?method=track.getInfo&api_key=943bdddf5707846447a81b95edae1537&artist=' + ambid + '&track=' + tmbid + '&format=json'
			
			url: 'http://ws.audioscrobbler.com/2.0/?method=track.getInfo&api_key=943bdddf5707846447a81b95edae1537&format=json&mbid=' + tmbid

			//url : 'http://ws.audioscrobbler.com/2.0/?method=track.getInfo&api_key=943bdddf5707846447a81b95edae1537&artist=' + ambid + '&track=' + tmbid + '&format=json'
		});
	}
	function mbTrack(mbid) {
		return $.ajax({
			async: false,
			url: 'https://musicbrainz.org/ws/2/recording/' + mbid + '?inc=aliases+artist-credits+releases&fmt=json'
		});
	}

	var song;
	fmArtists("chiefton117").done(function(d) {
		var tracks = d.recenttracks.track;
		console.log(tracks);
		if(tracks.length > 1) { // Iterate backwards to find the most recent track
			for(var i = tracks.length-1; i >= 0; i--) {
				if(tracks[i].date) song = tracks[i];
			}
		} else song = tracks[0];
	});
	console.log(song);

	//fmTrack(song.mbid, song.artist.mbid).done(function(d) {
	//	console.log(d);
	//});

	var cover = song.image[1]["#text"];
	var artist = song.artist["#text"];
	var album = song.album["#text"];

	//var date = song.date ? song.date["#text"] : 0;

	// Time difference in seconds
	var diff = Math.floor(Date.now()/1000) - parseInt(song.date.uts, 10);
	

	//const fmBox = document.querySelector(".music");
	var fmBox = $(".music");
	$(".cover").attr("src", cover);

	fmBox.text(
	"Song: " + song.name + "\n" +
	"Artist: " + artist + "\n" +
	"Album: " + album + "\n");

	$("#when").text(function() {
		return "Logged " + getTime(diff) + " ago";
	});

	var d = new Date();
	$(".date").text("Last Updated " + 
	d.toLocaleString());
	
	// Converts seconds to a string of days + hours + minutes
	function getTime(utc) {
		
		var minutes = Math.floor(utc/60) % 60;
		var hours = Math.floor(utc/3600) % 24;
		var days = Math.floor(utc/86400);

		var time = "";
		
		time = time + 
		(days > 0 ? days + " d, " : "") +
		(hours > 0 ? hours + " h, " : "") + 
		(minutes > 0 ? minutes + " m" : "");

		return time;

	}
</script>
</html>